# 外观的仿真
## 几何表示

### 隐式与显示表示

![[AI引论/AIimg/img8/image.png|463x265]]

隐式表示容易判断点与形状的关系（如在内部外部），但难以列举形状上的点
显示表示与之相反

### SDF

有符号距离函数：对空间每个点计算其到形状表面的距离，外部为正，内部为负
$$
(x, y) \mapsto f(x, y) =
\begin{cases} 
d > 0 & \text{外部} \\
d = 0 & \text{表面} \\
d < 0 & \text{内部}
\end{cases}
$$

对于一些复杂的情况，可以采取如下方式
![[AI引论/AIimg/img8/image-1.png]]

## 绘制

对于一个三维场景，想要以二维图像展示，有以下两种绘制方式

![[AI引论/AIimg/img8/image-3.png]]

第一种方式中，利用**光栅化**进行离散化处理

![[AI引论/AIimg/img8/image-2.png]]

根据每个像素与图形的重合程度设置颜色，可采用插值

第二种方式中，从屏幕后一个点光源发光，每个像素射出一条光线，由于光路的可逆性，就能得到汇入这个像素的光线，进而确定这个像素的颜色

这个颜色由物体本身颜色以及光线（包括环境光与反射折射）共同决定

### Lambertian 反射模型

理想漫反射
- 均匀粗糙的表面将接收到的入射的光均匀的反射到各个方向
- 反射的光强在各方向上均匀分布

朗伯余弦定律
$$
I = I_0 \cos \theta
$$
- $I$ 为观察到的物体表面的亮度
- $I_0$ 为光线本身的强度
- $\theta$ 为光线方向与物体表面法线之间的夹角

综合考虑环境光与漫反射，可以得到以下着色公式
$$
I = k_a I_a + k_d I_l \cos \theta
$$
-  $k_a$ 表示物体表面对环境光的反射比例
-  $I_a$ 为环境光的光强，通常用于模拟均匀的背景光照
-  $k_d$ 表示物体对入射光的漫反射比例
-  $I_l$ 为入射光 (光源) 的强度
-  $\theta$ 为入射光方向与表面法线夹角

![[AI引论/AIimg/img8/image-4.png|508x256]]


对于一些复杂的情况，光线可能经过多次反射折射，最后到达多个物体
**光线追踪**：从视点出发，沿着光路逆向迭代（考虑反射与折射），对光路上每个物体，应用光照模型计算颜色并累加

![[AI引论/AIimg/img8/image-5.png]]

# 物理过程的仿真

由于很难处理连续的空间和时间上的问题，所以需要进行离散化

时间离散化：分割成若干段时间微元
空间离散化
- 欧拉视角：对物体所在的空间离散化
- 拉格朗日视角：对物体本身离散化

## 欧拉方程

一些问题没有解析解，所以需要仿真模拟
在给定初始状态后，要模拟之后的运动过程，有如下计算方式

1. 显式/前向欧拉积分
$$
\begin{cases} 
v_{n+1} = v_n + m_n^{-1} f(x_n, v_n, t_n) \Delta t \\
x_{n+1} = x_n + v_n \Delta t
\end{cases}
$$

2. 隐式/后向欧拉积分
$$
\begin{cases} 
v_{n+1} = v_n + m_{n+1}^{-1} f(x_{n+1}, v_{n+1}, t_{n+1}) \Delta t \\
x_{n+1} = x_n + v_{n+1} \Delta t
\end{cases}
$$

3. 半隐式欧拉积分
$$
\begin{cases} 
v_{n+1} = v_n + m_{n}^{-1} f(x_n, v_n, t_n) \Delta t \\
x_{n+1} = x_n + v_{n+1} \Delta t
\end{cases}
$$

- 积分方法的数值稳定性：隐式积分 ≫ 半隐式积分 > 显式积分  
	- 条件稳定：显式积分，半隐式积分（通常需要较小的时间步长 $\Delta t \ll 1$ 才能保证数值稳定）
	- 无条件稳定：隐式积分  
- 积分方法的速度：隐式积分 ≪ 半隐式积分 ≲ 显式积分  

时间步越小，仿真精度更高

对于一些复杂的情况，往往使用隐式积分
如果使用显示积分，虽然单步计算量小，但需要更小的时间步才能有比较稳定的结果，时间步数量大大增加，而隐式积分总计算量可能更小

