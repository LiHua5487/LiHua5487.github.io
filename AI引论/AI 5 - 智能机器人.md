---
date: 2025-05-15
tags:
  - AI
---
# 基本信息


智能体计算框架
- 奖励/效用函数（reward or utility functions） 
- 状态（states）
- 动作（actions） 
- 观测空间（observation spaces）

机器人要干的事分为三级层次 
- 任务规划：确定高层次动作的规划或策略
- 运动规划：寻找两点间的路径，完成每个子目标
- 运动控制：使用执行器完成规划的动作

![[AI引论/AIimg/img6/image.png|452x281]]

此外还可能有一些任务
- 偏好学习：负责估计最终用户的目标
- 人类预测：用于预测机器人环境中其他人类的动作

# 定位与地图创建

要找到东西在哪里，包括确定机器人本身的位置

考虑一个简单的问题：平坦的二维世界中的移动机器人，且精确地图已知

先考虑机器人自己的移动状态

- 状态 $x_t = (x_t, y_t, \theta_t)^T$，包括位置 $(x_t, y_t)^T$，方向角 $\theta_t$
- 对于极短的 $\Delta t$，$a_t = (v_t, \omega_t)$ 为动作，包括平移速度 $v_t$，旋转速度 $\omega_t$

对于新状态 $x_{t+1}$，该机器人的一个期望的确定性运动模型为
$$
\hat{x}_{t+1} = f(X_t, v_t, \omega_t) = X_t + \begin{pmatrix}
v_t \Delta t \cos \theta_t \\
v_t \Delta t \sin \theta_t \\
\omega_t \Delta t
\end{pmatrix}
$$
但是因为存在噪音，机器人的真实状态是无法准确预测的，不过可以用高斯分布$\mathcal{N}$ 来表示
$$
P(X_{t+1} | X_t, v_t, \omega_t) = \mathcal{N}(\hat{X}_{t+1}, \Sigma_X)
$$

机器人还能对外界环境进行观测

- 在状态 $x_t = (x_t, y_t, \theta_t)^T$，传感器观测到地标 $(x_i, y_i)^T$

如果没有噪声，相对这个地标，距离和方位的准确预测应该为
$$
\hat{z}_t = h(X_t) = 
\begin{pmatrix}
\sqrt{(x_t - x_i)^2 + (y_t - y_i)^2} \\
\arctan \frac{y_i - y_t}{x_i - x_t} - \theta_t
\end{pmatrix}
$$
但是噪声会使得测量失真，所以在存在噪音的情况下，$\hat{z}_t$ 并不是真实的测量值 $z_t$。$z_t$ 的真实值也可以表示为概率模型
$$
P(z_t | x_t) = \mathcal{N}(\hat{z}_t, \Sigma_Z)
$$

需要在有噪音的条件下，利用对外界的观测 $z_t$ ， 预测机器人的状态 $X_t$ 

## 蒙特卡洛定位 MCL

使用**粒子滤波器**

先随机取样一堆点，代表机器人可能的位置，基于这些假设可以得到相应的观测结果，与实际的观测结果比较，选取结果相似的那些点

初始化：根据初始分布 $P(X_0)$ 进行采样，在定位任务中，在地图随机撒粒子 
在每一个时间步中，循环执行以下三步
- 预测：对于每个粒子，从运动模型中采样并加上随机且带噪声的值
- 更新：更新粒子权重，即在该处能获得已知传感器数据的可能性（归一化）
- 重采样 resample ：重新采样粒子，每个粒子根据其权重决定是否能被保留

例如，使用粒子滤波器对小飞机进行定位

首先，在地图上生成 大量随机分布粒子（在同一海拔高度）
初始状态没有任何飞机位置相关先验

我们可获得的信息
- 已知的地图信息
- 观测得到的小飞机离地面/海平面的高度 h （有不确定性）

假设每个位置观测得到 $h_i$ ，其权重定义为
$$
W_i = \frac{1}{(h_i-h)^2+\epsilon}
$$
归一化得到这个位置的概率
$$
P_i=\frac{W_i}{\sum W_j}
$$

![[AI引论/AIimg/img6/image-1.png]]

据此进行重采样，根据概率分布采样一定数量的粒子
这个采样是有放回的，只需保证最后总数是一定的
- 高权重的粒子更可能被多个重复采样，有一堆“复制”
- 低权重的粒子可能完全不被保留

![[AI引论/AIimg/img6/image-2.png]]

之后视这些粒子的权重相同，进行下一轮的重采样
飞机会向前移动一段距离，粒子也要向前移动（根据飞机运动的随机模型）
由于运动模型的随机性，原本重合的点会散开

![[AI引论/AIimg/img6/image-3.png]]

随着飞机运动，重复以上过程

初期定位不够准，但随着时间推理，定位越来越精准，粒子趋于集中
在山上定位比较准，但在海上定位不准，粒子仍会散开，因为表面信息有限

在这个过程中，机器人既得到了环境信息，也推测了自身位置，可以同步进行定位与地图绘制，即 SLAM

# 运动规划

运动可以这么描述
- 路径 ：机器人（或其部件）将遵循的几何空间中的一系列点
- 轨迹跟踪控制：有了路径后，执行一个动作序列来跟踪这条路径
- 轨迹：路径 + 时间信息

**工作空间**：描述的是机器人能够操作的物理空间，即其任务的几何区域
 - 如一个机械臂的工作空间是手爪可以到达的所有位置，通常是一个三维区域

**构型空间**：描述的是机器人内部状态组成的抽象空间，是用来表示机器人所有可能的自由度组合的数学空间
- 如一个机械臂的构型空间是所有关节角度的组合的高维空间

最终的目标是，保证不发生碰撞，找到构型空间中一个状态到另一个状态的过程

运动规划是连续状态搜索问题，但可以离散化其空间
运动规划问题亦称为搬钢琴问题：如何将一架很大的、形状不规则的钢琴从一个房间搬运到另一个房间，并且不碰碰到任何东西
- 已知：工作空间 $W$，构形空间 $C$，特定构形 $q \in C$ 下机器人上的所有点的集合 $\mathcal{A}(q)$，起始构形 $q_s \in C$，目标构形 $q_g \in C$
- 找到贯穿自由空间 $C_{\text{free}} = C - C_{\text{obs}}$ 的连续路径，即参数化的曲线 $\tau(t)$

![[AI引论/AIimg/img6/image-4.png]]

有很多方法，但基本的想法是把这个连续的构型空间图离散化，再进行搜索
- 能见度图：连接两个点的线段和障碍物无碰撞，在图𝐺上以起始构形为起始状态，以目标构形为目标状态运行离散图搜索
- 沃罗诺伊图式：使路径尽可能远离障碍物，用直线连接起始点和沃罗诺伊图上距其最近的点，并对目标点也进行相同操作，然后搜索
- 单元分解：将自由空间分解为有限数量的相邻区域（单元），单元内的路径规划问题可以用简单方法（如直线移动）解决，再在这些单元中分别搜索

![[AI引论/AIimg/img6/image-5.png]]

- 随机运动规划：采样一个随机的点集，如果点之间有简单的无碰撞到达方式（如直线），就在它们之间创建边，随后就可以在这个造出来的图上应用搜索

![[AI引论/AIimg/img6/image-6.png]]

- 快速探索随机树：下面重点介绍这个方法

## 快速探索随机树 RRT

- 初始状态，导入构型空间地图和起始点及目标点
- 在地图上随机采样一个点
- 计算在已有的点组成的 RRT 树上离这个点最近的点
- 以最近点到采样点的方向，前进 step size 距离（超参数）
- 移动过程如果没碰到障碍物，就把到达的点加到 RRT 里，否则重新取点
- 重复以上过程
- 当与目标点足够接近时，就停止搜索

![[AI引论/AIimg/img6/image-7.png|224x218]]![[AI引论/AIimg/img6/image-8.png|231x235]]![[AI引论/AIimg/img6/image-9.png|231x237]]

实际中采样时可以利用目标信息进行采样，倾向于采取离目标更近的点

缺点
- 构型空间有很多障碍物，或者通道过窄，就要试很多次，速度慢
- 如果通道很窄，可能采不到能通过的方向

一个改进：同时从起点和终点扩展 RRT，看能不能遇上

# 运动控制

运动规划做完后，还需要讨论如何让机器人真正移动起来，也即将电流传送给电 动机来产生扭矩，进而使机器人移动

主要解决两个问题
- 开环控制：如何将路径的数学描述转换为真实世界中的一系列动作
- 闭环控制：如何确保机器人在轨迹范围内运动

动力学模型：计算扭矩对构形的作用
逆动力学模型：要达到特定的加速度，需要施加多大的力

存在问题
- 实际系统中无法精准测量质量等物理量
- 动力学模型可能也无法恰当考虑一些物理现象(例如电动机中的静摩擦力) 
- 当机器人错误的施加扭矩，误差会累积，机器人会越来越偏离参考路径

解决思路：引入控制过程来避免误差累计，将实际位置与预期位置比较，然后施加扭矩来最小化误差

## PID控制器

考虑基本的**比例控制器（P控制器）**：施加正比于观测误差的扭矩
$$\quad u(t) = K_P (\xi(t) - q_t)$$
- $u(t)$ 为施加的扭矩
- $K_P$ 为增益因子（超参数）
- $\xi(t)$ 为预期位置
- $q_t$ 为当前构形 (实际位置)

$K_P$ 越大，就会以更快的速度到达目标

![[AI引论/AIimg/img6/image-10.png]]

实际过程中存在外界干扰，导致稳态误差难以避免，比如无人机飞行，由于风力的影响，可能导致稳定时的位置不是目标位置

可以引入积分控制，即对过去所有的误差求和，以抵消外部干扰
得到 **PI 控制器**
$$\quad u(t) = K_P (\xi(t) - q_t) + K_I \int_{0}^{t} (\xi(s) - q_s) ds$$
- $K_I \int_{0}^{t} (\xi(s) - q_s) ds$ 计算误差在时间上的积分
- 在离散情况下将误差直接累加并乘以 $K_I$

![[AI引论/AIimg/img6/image-11.png]]

但这会导致过冲和回调，震荡严重，还要引入微分控制器
得到 **PID 控制器**
$$\quad u(t) = K_P (\xi(t) - q_t) + K_I \int_{0}^{t} (\xi(s) - q_s) ds + K_D (\dot{\xi}(t) - \dot{q}_t)$$
- $K_D (\dot{\xi}(t) - \dot{q}_t)$ 计算误差的导数，离散化为误差在最近时刻的变化量

对误差的导数会反作用于比例项， 减少对扰动的总体影响
- 如果误差随时间快速变小，导数为负，抑制扭矩输出，防止过冲
- 如果误差随时间快速变大，导数为正，增大扭矩输出，应对这种变化
- 如果相同的误差一直存在且保持不变，导数就会消失

![[AI引论/AIimg/img6/image-12.png]]

将逆动力学与 PID 得到力学信息整合，得到最后的扭矩控制

$$
\begin{align}
u(t) &=\ f^{-1} (\xi(t), \dot{\xi}(t), \ddot{\xi}(t)) \\
&+\ m(\xi(t)) \left( K_P (\xi(t) - q_t) + K_I \int_{0}^{t} (\xi(s) - q_s) ds + K_D (\dot{\xi}(t) - \dot{q}_t) \right)
\end{align}
$$
- 前馈分量：逆动力学，预测机器人所需处于的位置并计算可能需要的扭矩
- 反馈分量：PID 得到，将动态的现有误差反馈给控制律
